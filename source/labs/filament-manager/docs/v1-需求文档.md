耗材管家 (Filament Manager) - 项目需求文档

维护人: FLC
版本: v1.0 (基于 v7 代码)
技术类型: Single File Web App (Serverless)

1. 项目概述

这是一个用于管理 3D 打印耗材（Filament）库存的轻量级网页应用。旨在解决 3D 打印爱好者（特别是拓竹 Bambu Lab 用户）耗材过多、难以记忆剩余量和具体颜色的痛点。
核心理念是**“可视化”与“轻量化”**，用户可以通过直观的色卡墙查看库存，并支持多设备云端同步。

2. 技术架构 (核心约束)

未来的开发需严格遵守以下技术栈，保持项目的轻量级特性：

运行模式: 单文件 HTML (Single-File Component)，无 Node.js 构建步骤，即开即用。

前端框架: Vue 3 (通过 ESM 模块引入: vue.esm-browser.js)。

UI 框架: Tailwind CSS (通过 CDN 引入)。

图标库: Phosphor Icons。

后端服务: Google Firebase (BaaS)。

Auth: Google 账号登录。

Database: Cloud Firestore (NoSQL)。

字体: Google Fonts (Inter)。

3. 数据模型 (Firestore Schema)

数据库集合名称: filaments

字段名

类型

说明

id

String

文档 ID (自动生成)

uid

String

用户 ID (用于数据隔离，必须与当前登录用户匹配)

brand

String

品牌 (如 "Bambu Lab", "eSun")

type

String

材质 (如 "PLA Basic", "PETG")

colorName

String

颜色名称 (如 "Bambu Green")

colorHex

String

16进制色值 (如 "#00AE42")，用于渲染 UI

remaining

Number

剩余百分比 (0-100)，整数

note

String

备注 (如 "AMS 插槽 1")

updatedAt

Timestamp

最后更新时间 (ServerTimestamp)

4. 已实现核心功能 (Current Features)

4.1 用户系统

支持 Google 账号一键登录/登出。

数据隔离: 用户只能看到属于自己 (uid 匹配) 的数据。

加载状态: 处理了 Auth 加载中的 Loading 动画。

4.2 库存可视化 (色卡墙)

卡片设计: 背景色根据耗材 colorHex 动态渲染。

文字反色: 自动计算背景亮度，智能调整文字颜色（黑/白）以保证可读性。

剩余量可视化: 卡片内部水位线（Water Level）高度对应剩余百分比。

低库存预警: 剩余量 <= 10% 时显示红色警告图标。

4.3 库存管理 (CRUD)

入库/编辑: 弹窗表单，支持滑动条调整库存。

预设库: 内置 Bambu Lab 官方色卡（PLA Basic/Matte, PETG, ABS 等），点击色点自动填充品牌、材质、色名和色值。

删除: 二次确认后删除文档。

网络处理: 增加了 10秒 超时检测，并对“权限不足”和“索引构建中”错误进行了人性化提示。

4.4 视图与交互 (进阶)

多视图切换:

库存中 (In Stock): 仅显示 remaining > 0 的耗材。

已耗尽 (Depleted): 仅显示 remaining == 0 的耗材（历史归档）。

智能聚合 (Smart Grouping):

开关控制。开启后，将“品牌+材质+颜色”完全相同的耗材合并为一个“堆叠卡片”。

显示总卷数（例如 x3）和总估算库存。

点击聚合卡片可查看子列表详情。

FOUC 修复: 使用 v-cloak + !important 彻底解决了页面加载时的乱码闪烁问题。

5. 待开发需求 (Pending Tasks)

以下功能需要在下一阶段代码中落实：

产品名称本地化:

将顶部导航栏标题由 "FilamentManager" 修改为 "耗材管家"。

统计仪表盘 (Dashboard):

入口: 在顶部导航栏增加统计图标。

交互: 点击弹出 Modal。

统计逻辑:

总净重估算: 假设每卷标准净重 1kg，计算 ∑(剩余百分比 × 1kg)。

材质分布: 饼图或列表展示（如 PLA: 8卷, PETG: 2卷）。

版权信息:

页面底部增加 Footer。

内容: © 2024 FLC. Designed for Makers.

6. 安全规则 (Firestore Rules)

任何后续开发必须保证生成的代码符合以下安全规则，否则会导致权限错误：

rules_version = '2';
service cloud.firestore {
match /databases/{database}/documents {
match /filaments/{document} {
// 仅允许操作属于自己的数据 (uid 匹配)
allow create: if request.auth != null && request.resource.data.uid == request.auth.uid;
allow read, update, delete: if request.auth != null && resource.data.uid == request.auth.uid;
}
}
}


7. 索引配置 (Firestore Indexes)

应用使用了复合查询（筛选 uid + 按时间排序），如果控制台报错，需要创建以下索引：

Collection ID: filaments

Fields: uid (Ascending) + updatedAt (Descending)