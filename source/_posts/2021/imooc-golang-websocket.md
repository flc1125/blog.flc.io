----
title: 笔记：GO 实现千万级 WebSocket 消息推送服务
date: 2021-05-24 21:45:05
updated: 2021-05-24 21:45:08
categories: [编程,后端]
tags: 
- Go
- 笔记
toc: true
----

## 前言

团队内组织 Golang 的学习，这是第四周学习内容：完成课程的学习、代码编写与心得总结。

**相关课程**

https://www.imooc.com/learn/1025

## 内容

### 弹幕技术复杂度

**假设 1 个直播间：**

- 在线人数：100万人
- 发送弹幕：1000条/秒
- 推送频率：100万 * 1000条/秒 = **10亿条/秒**

<!-- more -->

**假设 N 个直播间：**

- 推送频率：**N * 10亿条/秒**

**拉模式与推模式的区别：**

拉模式：

- 若更新频率低，大多数请求是无效的
- 若在线用户数多，服务的查询负载高
- 定时轮询，无法满足时效性

推模式：

- 仅更新才推送
- 需维护大量的长连接
- 数据更新后，立即推送

基于 websocket 推送

- 浏览器支持 socket
- 基于 TCP 协议，安全可靠
- 生态工具良好，低成本接入

### WebSocket 协议

**通讯流程**

![](https://s.flc.io/2021-05-24-22-49-43.png)

**传输原理**

- 协议升级后，复用 HTTP 底层的 socket 协议完成通讯
- message 底层被分割成多个 frame 帧传输
- 编程只需关心 message，无需关心 frame
- 框架底层进行 TCP 网络的 I/O，websocket 协议的解析